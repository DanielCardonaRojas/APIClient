<!DOCTYPE html>
<html lang="en">
  <head>
    <title>APIClient  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="APIClient  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">APIClient 1.0.1 Docs</a> (71% documented)</p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">APIClient Reference</a>
        <img id="carat" src="img/carat.png" />
        APIClient  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/APIClient.html">APIClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Endpoint.html">Endpoint</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MockDataClientHijacker.html">MockDataClientHijacker</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RequestBuilder.html">RequestBuilder</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RequestBuilder/Method.html">– Method</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RequestBuilder/Encoding.html">– Encoding</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/RequestMatchingCriteria.html">RequestMatchingCriteria</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/URLRequest.html">URLRequest</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/ClientHijacker.html">ClientHijacker</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/URLRequestConvertible.html">URLRequestConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/URLResponseCapable.html">URLResponseCapable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/APIClientPublisher.html">APIClientPublisher</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:9APIClient11MockedErrorV">MockedError</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:9APIClient12NetworkErrorV">NetworkError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:9APIClient4Patha">Path</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='api-client' class='heading'>API Client</h1>

<p><img src="https://github.com/DanielCardonaRojas/APIClient/workflows/APIClientTests/badge.svg" alt="APIClientTests">
<img src="https://img.shields.io/github/v/tag/DanielCardonaRojas/APIClient" alt="">
<a href="https://codecov.io/gh/DanielCardonaRojas/APIClient"><img src="https://codecov.io/gh/DanielCardonaRojas/APIClient/branch/master/graph/badge.svg?token=SJPX8AG809" alt="codecov"></a></p>

<p>A simple networking abstraction inspired by: <a href="http://kean.github.io/post/api-client">http://kean.github.io/post/api-client</a></p>
<h2 id='features' class='heading'>Features</h2>

<ul>
<li>Provides RequestBuilder easily create your requests</li>
<li>Declarative definition of endpoints</li>
<li>Define your endpoints mostly with relative paths to a base URL.</li>
<li>Easily adaptable to use with common reactive frameworks (RxSwift, PromiseKit) via extensions</li>
<li>Comes with Combine support.</li>
<li>Chain multiple requests easily</li>
<li>Mocks responses easily</li>
</ul>
<h2 id='documentation' class='heading'>Documentation</h2>

<p>Checkout the docs <a href="https://danielcardonarojas.github.io/APIClient">here</a></p>
<h1 id='installation' class='heading'>Installation</h1>
<h2 id='carthage' class='heading'>Carthage</h2>
<pre class="highlight shell"><code>github <span class="s2">"DanielCardonaRojas/APIClient"</span> ~&gt; 1.0.1
</code></pre>
<h2 id='cocoapods' class='heading'>Cocoapods</h2>
<pre class="highlight shell"><code>pod <span class="s1">'APIClient'</span>, :git <span class="o">=&gt;</span> <span class="s1">'https://github.com/DanielCardonaRojas/APIClient'</span>, :tag <span class="o">=&gt;</span> <span class="s1">'1.0.1'</span>, :branch <span class="o">=&gt;</span> <span class="s1">'master'</span>
</code></pre>
<h2 id='swiftpm' class='heading'>SwiftPM</h2>
<pre class="highlight shell"><code>.package<span class="o">(</span>url: <span class="s2">"https://github.com/DanielCardonaRojas/APIClient"</span>, .upToNextMajor<span class="o">(</span>from: <span class="s2">"1.0.0"</span><span class="o">))</span>
</code></pre>
<h1 id='usage' class='heading'>Usage</h1>

<ol>
<li>Create a client object pointing to some base url</li>
</ol>
<pre class="highlight swift"><code><span class="kd">lazy</span> <span class="k">var</span> <span class="nv">client</span><span class="p">:</span> <span class="kt">APIClient</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">URLSessionConfiguration</span><span class="o">.</span><span class="k">default</span>
    <span class="k">let</span> <span class="nv">client</span> <span class="o">=</span> <span class="kt">APIClient</span><span class="p">(</span><span class="nv">baseURL</span><span class="p">:</span> <span class="s">"https://jsonplaceholder.typicode.com"</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
<span class="p">}()</span>
</code></pre>

<ol>
<li>Define a declerative API</li>
</ol>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Todo</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">completed</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="kt">API</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">Todos</span> <span class="p">{</span>
        <span class="kd">static</span> <span class="kd">func</span> <span class="nf">get</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Endpoint</span><span class="o">&lt;</span><span class="kt">Todo</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">Endpoint</span><span class="o">&lt;</span><span class="kt">Todo</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">method</span><span class="p">:</span> <span class="o">.</span><span class="k">get</span><span class="p">,</span> <span class="nv">path</span><span class="p">:</span> <span class="s">"/todos/1"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ol>
<li>Consume the API (Comes with Callback and combine API), refer to the section below to integrate with PromiseKit or RxSwift</li>
</ol>

<p><strong>Callback API</strong></p>
<pre class="highlight swift"><code><span class="n">client</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">item</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">},</span> <span class="nv">fail</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Error </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>


</code></pre>

<p><strong>Combine API</strong></p>
<pre class="highlight swift"><code><span class="c1">// Combine API</span>
<span class="k">let</span> <span class="nv">publisher</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Todo</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>

<span class="n">publisher</span><span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">=</span> <span class="n">completion</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Error </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span><span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">disposables</span><span class="p">)</span>
</code></pre>
<h2 id='chaining-multiple-request' class='heading'>Chaining multiple request</h2>

<p>Alternatively to using the regular combine API of the APIClient class, APIClientPublisher
creates a custom publisher from a APIClient and allows to easily chain multiple endpoints creating
a sequence dependent requests.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">endpoint</span><span class="p">:</span> <span class="kt">Endpoint</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Post</span><span class="p">]</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">Endpoint</span><span class="p">(</span><span class="nv">method</span><span class="p">:</span> <span class="o">.</span><span class="k">get</span><span class="p">,</span> <span class="nv">path</span><span class="p">:</span> <span class="s">"/posts"</span><span class="p">)</span>

<span class="kt">APIClientPublisher</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span> <span class="n">client</span><span class="p">,</span> <span class="nv">endpoint</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">)</span><span class="o">.</span><span class="nf">chain</span><span class="p">({</span>
    <span class="kt">Endpoint</span><span class="o">&lt;</span><span class="kt">PostDetail</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">method</span><span class="p">:</span> <span class="o">.</span><span class="k">get</span><span class="p">,</span> <span class="nv">path</span><span class="p">:</span> <span class="s">"/posts/</span><span class="se">\(</span><span class="nv">$0</span><span class="o">.</span><span class="n">first</span><span class="o">!.</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
<span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>

<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
    <span class="n">expectation</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span>
<span class="p">})</span><span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">disposables</span><span class="p">)</span>
</code></pre>
<h2 id='retrying-a-request' class='heading'>Retrying a request</h2>

<p>There is no built interceptors in this package but retrying requests and other related effects
can be accomplished, using combine built in facilities.</p>

<p>Retrying requests can be accomplished using <code>tryCatch</code> and has been documented by many authors,
give <a href="https://www.donnywals.com/retrying-a-network-request-with-a-delay-in-combine/">this</a> a read for more details</p>
<pre class="highlight swift"><code>  <span class="c1">// Copied from https://www.donnywals.com/retrying-a-network-request-with-a-delay-in-combine/</span>
  <span class="o">.</span><span class="nf">tryCatch</span><span class="p">({</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">,</span> <span class="nv">response</span><span class="p">:</span> <span class="kt">URLResponse</span><span class="p">),</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"In the tryCatch"</span><span class="p">)</span>

    <span class="k">switch</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kt">DataTaskError</span><span class="o">.</span><span class="n">rateLimitted</span><span class="p">,</span> <span class="kt">DataTaskError</span><span class="o">.</span><span class="nv">serverBusy</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">dataTaskPublisher</span>
        <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">())</span>
        <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="k">default</span><span class="p">:</span>
      <span class="k">throw</span> <span class="n">error</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
<h2 id='mocking-responses' class='heading'>Mocking Responses</h2>

<p>It is easy to add fake responses that will bypass any http calls.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">client</span><span class="p">:</span> <span class="kt">APIClient</span> <span class="o">=</span> <span class="o">...</span>


<span class="kt">MockDataClientHijacker</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="nf">registerSubstitute</span><span class="p">(</span><span class="kt">User</span><span class="o">.</span><span class="nf">fake</span><span class="p">(),</span> <span class="nv">requestThatMatches</span><span class="p">:</span> <span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="err">#</span><span class="s">"/posts/*"</span><span class="err">#</span><span class="p">))</span>

<span class="n">client</span><span class="o">.</span><span class="n">hijacker</span> <span class="o">=</span> <span class="kt">MockDataClientHijacker</span><span class="o">.</span><span class="n">sharedInstance</span>


<span class="k">let</span> <span class="nv">endpoint</span> <span class="o">=</span> <span class="kt">Endpoint</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">method</span><span class="p">:</span> <span class="o">.</span><span class="k">get</span><span class="p">,</span> <span class="nv">path</span><span class="p">:</span> <span class="s">"/"</span><span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span> <span class="c1">// Will return fake User</span>

</code></pre>
<h1 id='promisekit-integration' class='heading'>PromiseKit Integration</h1>

<p>Integrating PromiseKit can be done through the following extension:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">PromiseKit</span>

<span class="kd">extension</span> <span class="kt">APIClient</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">request</span><span class="o">&lt;</span><span class="kt">Response</span><span class="p">,</span> <span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">requestConvertible</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span>
                              <span class="n">additionalHeaders</span> <span class="nv">headers</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
                              <span class="n">additionalQuery</span> <span class="nv">queryParameters</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
                              <span class="nv">baseUrl</span><span class="p">:</span> <span class="kt">URL</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">.</span><span class="kt">Result</span><span class="o">&gt;</span>
        <span class="k">where</span> <span class="kt">T</span><span class="p">:</span> <span class="kt">URLResponseCapable</span><span class="p">,</span> <span class="kt">T</span><span class="p">:</span> <span class="kt">URLRequestConvertible</span><span class="p">,</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Result</span> <span class="o">==</span> <span class="kt">Response</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">Promise</span> <span class="p">{</span> <span class="n">seal</span> <span class="k">in</span>
                <span class="k">self</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">requestConvertible</span><span class="p">,</span> <span class="nv">additionalHeaders</span><span class="p">:</span> <span class="n">headers</span><span class="p">,</span> <span class="nv">additionalQuery</span><span class="p">:</span> <span class="n">queryParameters</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
                    <span class="n">seal</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="p">},</span> <span class="nv">fail</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
                    <span class="n">seal</span><span class="o">.</span><span class="nf">reject</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="p">})</span>

            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>
<h1 id='rxswift-integration' class='heading'>RxSwift Integration</h1>

<p>Use this extension</p>
<pre class="highlight shell"><code>import RxSwift

extension APIClient <span class="o">{</span>

    func request&lt;Response, T&gt;<span class="o">(</span>_ requestConvertible: T,
                              additionalHeaders headers: <span class="o">[</span>String: String]? <span class="o">=</span> nil,
                              additionalQuery queryParameters: <span class="o">[</span>String: String]? <span class="o">=</span> nil,
                              baseUrl: URL? <span class="o">=</span> nil<span class="o">)</span> -&gt; Observable&lt;T.Result&gt;
        where T: URLResponseCapable, T: URLRequestConvertible, T.Result <span class="o">==</span> Response <span class="o">{</span>

            <span class="k">return </span>Observable.create<span class="o">({</span> observer <span class="k">in
                </span><span class="nb">let </span>dataTask <span class="o">=</span> self.request<span class="o">(</span>requestConvertible, additionalHeaders: headers, additionalQuery: queryParameters, baseUrl: baseUrl, success: <span class="o">{</span> response <span class="k">in
                    </span>observer.onNext<span class="o">(</span>response<span class="o">)</span>
                    observer.onCompleted<span class="o">()</span>
                <span class="o">}</span>, fail: <span class="o">{</span>error <span class="k">in
                    </span>observer.onError<span class="o">(</span>error<span class="o">)</span>
                <span class="o">})</span>

                <span class="k">return </span>Disposables.create <span class="o">{</span>
                    dataTask?.cancel<span class="o">()</span>
                <span class="o">}</span>
            <span class="o">})</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="https://github.com/DanielCardonaRojas/APIClient" target="_blank" rel="external">Daniel Cardona</a>. All rights reserved. (Last updated: 2021-03-13)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
